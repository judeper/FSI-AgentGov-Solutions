{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Environment Request",
  "description": "Schema for Copilot Studio agent output when submitting environment requests to Power Automate",
  "type": "object",
  "required": [
    "requestId",
    "timestamp",
    "requester",
    "environment",
    "classification",
    "businessContext",
    "approvalRequired"
  ],
  "properties": {
    "requestId": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for this request (generated by flow)"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when request was submitted"
    },
    "requester": {
      "type": "object",
      "required": ["upn"],
      "properties": {
        "upn": {
          "type": "string",
          "format": "email",
          "description": "User principal name (email) of the requester"
        },
        "displayName": {
          "type": "string",
          "description": "Display name of the requester"
        },
        "department": {
          "type": "string",
          "description": "Department of the requester"
        }
      }
    },
    "environment": {
      "type": "object",
      "required": ["name", "type", "region"],
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[A-Z]{2,4}-[A-Za-z0-9]+-[A-Z]+$",
          "description": "Environment name following DEPT-Purpose-TYPE convention"
        },
        "type": {
          "type": "string",
          "enum": ["Sandbox", "Production", "Developer"],
          "description": "Type of environment"
        },
        "region": {
          "type": "string",
          "enum": ["unitedstates", "europe", "unitedkingdom", "australia"],
          "description": "Geographic region for environment (lowercase for API)"
        }
      }
    },
    "classification": {
      "type": "object",
      "required": ["zone", "dataSensitivity"],
      "properties": {
        "zone": {
          "type": "integer",
          "enum": [1, 2, 3],
          "description": "Governance zone classification"
        },
        "autoFlags": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "RESTRICTED_DATA",
              "CUSTOMER_PII",
              "FINANCIAL_TRANSACTIONS",
              "EXTERNAL_ACCESS",
              "CONFIDENTIAL_DATA",
              "PRODUCTION_WORKLOAD",
              "TEAM_WORKLOAD"
            ]
          },
          "description": "Auto-detected classification triggers"
        },
        "dataSensitivity": {
          "type": "string",
          "enum": ["Public", "Internal", "Confidential", "Restricted"],
          "description": "Data sensitivity level"
        },
        "zoneRationale": {
          "type": "string",
          "description": "Business rationale for zone classification (required for Zone 3)"
        }
      }
    },
    "access": {
      "type": "object",
      "properties": {
        "securityGroupId": {
          "type": "string",
          "format": "uuid",
          "description": "Entra ID security group GUID (required for Zone 2/3)"
        },
        "securityGroupName": {
          "type": "string",
          "description": "Display name of security group"
        },
        "expectedUserCount": {
          "type": "integer",
          "minimum": 1,
          "description": "Expected number of users"
        }
      }
    },
    "businessContext": {
      "type": "object",
      "required": ["purpose"],
      "properties": {
        "purpose": {
          "type": "string",
          "minLength": 20,
          "description": "Business purpose and justification"
        },
        "expectedUsers": {
          "type": "string",
          "description": "Description of expected user population"
        }
      }
    },
    "approvalRequired": {
      "type": "object",
      "required": ["manager", "compliance"],
      "properties": {
        "manager": {
          "type": "boolean",
          "description": "Whether manager approval is required"
        },
        "compliance": {
          "type": "boolean",
          "description": "Whether compliance review is required"
        },
        "zoneReviewRequired": {
          "type": "boolean",
          "description": "Whether zone classification dispute review is needed"
        }
      }
    }
  },
  "examples": [
    {
      "requestId": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
      "timestamp": "2026-01-29T14:30:00Z",
      "requester": {
        "upn": "john.smith@contoso.com",
        "displayName": "John Smith",
        "department": "Finance"
      },
      "environment": {
        "name": "FIN-QuarterlyReporting-PROD",
        "type": "Production",
        "region": "unitedstates"
      },
      "classification": {
        "zone": 3,
        "autoFlags": ["CUSTOMER_PII", "FINANCIAL_TRANSACTIONS"],
        "dataSensitivity": "Confidential",
        "zoneRationale": "Environment will process quarterly financial reports containing customer account data."
      },
      "access": {
        "securityGroupId": "12345678-1234-1234-1234-123456789012",
        "securityGroupName": "FIN-QuarterlyReporting-Users",
        "expectedUserCount": 25
      },
      "businessContext": {
        "purpose": "Quarterly financial reporting automation for SEC 10-Q filings",
        "expectedUsers": "Finance reporting team, 25 users including 3 external auditors"
      },
      "approvalRequired": {
        "manager": true,
        "compliance": true,
        "zoneReviewRequired": false
      }
    }
  ]
}
